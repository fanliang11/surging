This was ripped straight out of Alex Robson's excellent Symbiote library.
https://github.com/arobson/Symbiote